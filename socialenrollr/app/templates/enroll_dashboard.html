{% extends "base.html" %}
{% block title %}Enrollment Dashboard - {{ brand.app_name }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="fas fa-gauge-high"></i> Enrollment Dashboard</h1>
    <p class="subtitle">{{ client.full_name }} â€” {{ client.email }}</p>
</div>

<div class="client-info-bar">
    <div class="info-item"><i class="fas fa-envelope"></i> {{ client.email }}</div>
    {% if client.phone %}<div class="info-item"><i class="fas fa-phone"></i> {{ client.phone }}</div>{% endif %}
    {% if client.business_name %}<div class="info-item"><i class="fas fa-building"></i> {{ client.business_name }}</div>{% endif %}
</div>

<div class="copy-bar">
    <span class="copy-label">Quick Copy:</span>
    <button class="copy-btn" data-copy="{{ client.first_name }}">First Name</button>
    <button class="copy-btn" data-copy="{{ client.last_name }}">Last Name</button>
    <button class="copy-btn" data-copy="{{ client.email }}">Email</button>
    {% if client.phone %}<button class="copy-btn" data-copy="{{ client.phone }}">Phone</button>{% endif %}
    {% if client.bio %}<button class="copy-btn" data-copy="{{ client.bio }}">Bio</button>{% endif %}
    {% if client.business_name %}<button class="copy-btn" data-copy="{{ client.business_name }}">Business</button>{% endif %}
    {% if client.home_address %}<button class="copy-btn" data-copy="{{ client.home_address }}, {{ client.home_city }}, {{ client.home_state }} {{ client.home_zip }}">Home Address</button>{% endif %}
    {% if client.business_address %}<button class="copy-btn" data-copy="{{ client.business_address }}, {{ client.business_city }}, {{ client.business_state }} {{ client.business_zip }}">Biz Address</button>{% endif %}
</div>

<div class="enrollment-list">
    {% for item in enrollment_data %}
    <div class="enrollment-card status-{{ item.enrollment.status }}">
        <div class="enrollment-header">
            <div class="platform-badge" style="background: {{ item.platform.color or '#666' }};">
                <i class="{{ item.platform.icon or 'fas fa-globe' }}"></i>
            </div>
            <div class="enrollment-info">
                <h3>{{ item.platform.name or item.platform_key }}</h3>
                <span class="username-display">@{{ item.enrollment.chosen_username }}</span>
            </div>
            <div class="enrollment-status">
                <span class="status-badge status-{{ item.enrollment.status }}">
                    {{ item.enrollment.status | title }}
                </span>
            </div>
        </div>

        <div class="enrollment-actions">
            <button class="copy-btn" data-copy="{{ item.enrollment.chosen_username }}">
                <i class="fas fa-copy"></i> Copy Username
            </button>

            {% if item.platform.signup_url %}
            <a href="{{ item.platform.signup_url }}" target="_blank" class="btn btn-primary btn-sm">
                <i class="fas fa-external-link-alt"></i> Open Sign-Up Page
            </a>
            {% endif %}

            {% if item.enrollment.profile_url %}
            <a href="{{ item.enrollment.profile_url }}" target="_blank" class="btn btn-secondary btn-sm">
                <i class="fas fa-link"></i> View Profile
            </a>
            {% endif %}
        </div>

        <form method="POST" action="/enroll/enrollment/{{ item.enrollment.id }}/update" class="enrollment-update-form">
            <div class="update-row">
                <select name="status" class="status-select">
                    <option value="pending" {{ 'selected' if item.enrollment.status == 'pending' }}>Pending</option>
                    <option value="in_progress" {{ 'selected' if item.enrollment.status == 'in_progress' }}>In Progress</option>
                    <option value="completed" {{ 'selected' if item.enrollment.status == 'completed' }}>Completed</option>
                    <option value="failed" {{ 'selected' if item.enrollment.status == 'failed' }}>Failed</option>
                </select>
                <input type="text" name="profile_url" placeholder="Profile URL (after signup)"
                       value="{{ item.enrollment.profile_url or '' }}">
                <input type="text" name="notes" placeholder="Notes..."
                       value="{{ item.enrollment.notes or '' }}">
                <button type="submit" class="btn btn-primary btn-sm">Update</button>
            </div>
        </form>
    </div>
    {% endfor %}
</div>

<div class="form-actions">
    <a href="/enroll/{{ client.id }}/platforms" class="btn btn-secondary">
        <i class="fas fa-plus"></i> Add More Platforms
    </a>
    <a href="/enroll/clients" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Back to Clients
    </a>
</div>
{% endblock %}

{% extends "base.html" %}

{% block title %}{{ song.title }} - KMGI Radio Automation{% endblock %}

{% block content %}
<div class="page-header">
    <a href="{{ url_for('library') }}" class="back-link">← Back to Library</a>
    <h1>{{ song.title }}</h1>
    <p>{{ song.artist }}</p>
</div>

<div class="song-detail-grid">
    <div class="card">
        <h3>Basic Information</h3>
        <table class="data-table">
            <tr>
                <td>Title</td>
                <td><strong>{{ song.title }}</strong></td>
            </tr>
            <tr>
                <td>Artist</td>
                <td><strong>{{ song.artist }}</strong></td>
            </tr>
            <tr>
                <td>Album</td>
                <td>{{ song.album or '-' }}</td>
            </tr>
            <tr>
                <td>Year</td>
                <td>{{ song.year or '-' }}</td>
            </tr>
            <tr>
                <td>Genre</td>
                <td>{{ song.genre or '-' }}</td>
            </tr>
            <tr>
                <td>Duration</td>
                <td>{{ '%d:%02d'|format((song.duration_seconds or 0) // 60, (song.duration_seconds or 0) % 60) }}</td>
            </tr>
        </table>
    </div>

    <div class="card">
        <h3>Radio Categories</h3>
        <table class="data-table">
            <tr>
                <td>Category</td>
                <td><span class="badge badge-category">{{ song.category or 'Not Set' }}</span></td>
            </tr>
            <tr>
                <td>Gender</td>
                <td>{{ song.gender or '-' }}</td>
            </tr>
            <tr>
                <td>Tempo</td>
                <td>{{ song.tempo or '-' }} {% if song.tempo_bpm %}({{ song.tempo_bpm }} BPM){% endif %}</td>
            </tr>
            <tr>
                <td>Mood</td>
                <td>{{ song.mood or '-' }}</td>
            </tr>
            <tr>
                <td>Energy</td>
                <td>{{ song.energy or '-' }}</td>
            </tr>
            <tr>
                <td>Explicit</td>
                <td>{{ 'Yes' if song.explicit else 'No' }}</td>
            </tr>
            <tr>
                <td>Active</td>
                <td>{{ 'Yes' if song.is_active else 'No' }}</td>
            </tr>
        </table>
    </div>

    <div class="card">
        <h3>Timing Information</h3>
        <table class="data-table">
            <tr>
                <td>Intro</td>
                <td>{{ '%.1f'|format(song.intro_seconds or 0) }} seconds</td>
            </tr>
            <tr>
                <td>Outro</td>
                <td>{{ '%.1f'|format(song.outro_seconds or 0) }} seconds</td>
            </tr>
            {% if song.hook_start %}
            <tr>
                <td>Hook Start</td>
                <td>{{ '%.1f'|format(song.hook_start) }} seconds</td>
            </tr>
            {% endif %}
        </table>
    </div>

    <div class="card">
        <h3>Play Statistics</h3>
        <table class="data-table">
            <tr>
                <td>Total Plays</td>
                <td><strong>{{ song.play_count }}</strong></td>
            </tr>
            <tr>
                <td>Last Played</td>
                <td>{{ song.last_played.strftime('%Y-%m-%d %H:%M') if song.last_played else 'Never' }}</td>
            </tr>
            <tr>
                <td>Date Added</td>
                <td>{{ song.date_added.strftime('%Y-%m-%d') if song.date_added else '-' }}</td>
            </tr>
            <tr>
                <td>Rating</td>
                <td>{{ '★' * (song.rating or 0) }}{{ '☆' * (5 - (song.rating or 0)) }}</td>
            </tr>
        </table>
    </div>

    <div class="card">
        <h3>File Information</h3>
        <table class="data-table">
            <tr>
                <td>Path</td>
                <td><code style="font-size: 0.8em; word-break: break-all;">{{ song.file_path }}</code></td>
            </tr>
            <tr>
                <td>Format</td>
                <td>{{ song.file_format or '-' }}</td>
            </tr>
            <tr>
                <td>Bitrate</td>
                <td>{{ song.bitrate or '-' }} kbps</td>
            </tr>
            <tr>
                <td>Sample Rate</td>
                <td>{{ song.sample_rate or '-' }} Hz</td>
            </tr>
        </table>
    </div>

    <div class="card">
        <h3>Recent Plays</h3>
        {% if recent_plays %}
        <table class="data-table full-width">
            <thead>
                <tr>
                    <th>Date/Time</th>
                    <th>Daypart</th>
                    <th>Source</th>
                </tr>
            </thead>
            <tbody>
                {% for play in recent_plays %}
                <tr>
                    <td>{{ play.played_at.strftime('%Y-%m-%d %H:%M') }}</td>
                    <td>{{ play.daypart }}</td>
                    <td>{{ play.source }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p class="text-muted">No play history</p>
        {% endif %}
    </div>
</div>
{% endblock %}
